<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥ç³»è¨­è¨ˆå¸«å ±åƒ¹ç³»çµ± (å‚™è¨»å›æ­¸ç‰ˆ)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --sidebar-width: 360px;
            --bg-color: #E5E5E5;
            --paper-width: 210mm;
            --paper-height: 297mm;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- å·¦å´ç·¨è¼¯å€ --- */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: #fff;
            height: 100%;
            display: flex;
            flex-direction: column;
            z-index: 50;
            border-right: 1px solid #ddd;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }
        .sidebar h2 { font-size: 18px; color: #333; margin: 0 0 20px 0; font-weight: 700; letter-spacing: 1px; }
        
        .form-section { margin-bottom: 25px; }
        .label { font-size: 13px; font-weight: 700; color: #555; margin-bottom: 8px; display: block; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 6px; font-size: 14px; margin-bottom: 10px; background: #fafafa; transition: 0.2s; }
        .form-control:focus { border-color: #333; background: #fff; outline: none; }
        
        /* é¢¨æ ¼é¸æ“‡ */
        .style-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .style-card { border: 2px solid transparent; background: #f4f4f4; padding: 15px 5px; text-align: center; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .style-card span { display: block; font-size: 13px; font-weight: 700; color: #555; }
        .style-card small { display: block; font-size: 10px; color: #999; margin-top: 2px; }
        
        .style-card.btn-intellect.active { background: #2C3E50; border-color: #2C3E50; }
        .style-card.btn-intellect.active span, .style-card.btn-intellect.active small { color: #fff; }
        .style-card.btn-nature.active { background: #5D6D56; border-color: #5D6D56; }
        .style-card.btn-nature.active span, .style-card.btn-nature.active small { color: #fff; }
        .style-card.btn-minimal.active { background: #000; border-color: #000; }
        .style-card.btn-minimal.active span, .style-card.btn-minimal.active small { color: #fff; }

        .item-row { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 10px; position: relative; }
        .btn-del { position: absolute; top: 10px; right: 10px; color: #e74c3c; border: none; background: none; cursor: pointer; font-size: 12px; }
        .btn-add { width: 100%; padding: 12px; border: 1px dashed #bbb; color: #666; background: none; border-radius: 6px; cursor: pointer; font-weight: 700; }
        .btn-add:hover { border-color: #333; color: #333; background: #fff; }

        .desktop-download { padding: 20px; border-top: 1px solid #eee; }
        .btn-main { width: 100%; padding: 15px; background: #2D3436; color: white; border: none; border-radius: 6px; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-main:hover { background: #000; }

        /* --- å³å´é è¦½å€ --- */
        .preview-area { 
            flex: 1; height: 100%; overflow: hidden; background-color: #525659;
            position: relative; display: flex; align-items: flex-start; justify-content: center;
        }
        
        .zoom-container { padding: 20px; transform-origin: top center; transition: transform 0.2s ease; margin-bottom: 50px; }

        /* --- A4 ç´™å¼µ --- */
        #invoice-paper { width: var(--paper-width); min-height: var(--paper-height); background: #fff; padding: 0; box-shadow: 0 20px 60px rgba(0,0,0,0.4); position: relative; }

        /* --- æ‰‹æ©Ÿå°èˆª --- */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ddd; z-index: 100; padding-bottom: env(safe-area-inset-bottom); box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-grid { display: flex; height: 60px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #999; cursor: pointer; border: none; background: none; }
        .nav-item.active { color: #2D3436; font-weight: 700; }
        
        @media (max-width: 900px) {
            .mobile-nav { display: block; }
            .desktop-download { display: none; }
            .sidebar { position: absolute; top: 0; left: 0; width: 100%; height: calc(100% - 60px); transform: translateX(0); }
            .preview-area { position: absolute; top: 0; left: 0; width: 100%; height: calc(100% - 60px); transform: translateX(100%); background: #333; }
            body[data-view="preview"] .sidebar { transform: translateX(-100%); }
            body[data-view="preview"] .preview-area { transform: translateX(0); }
        }

        /* =========================================
           è¡¨æ ¼èˆ‡æ’ç‰ˆ
           ========================================= */

        .page-content { padding: 12mm; height: 100%; position: relative; }
        
        .inv-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; table-layout: fixed; }
        .inv-table td { vertical-align: top; line-height: 1.6; padding: 12px 5px; word-wrap: break-word; overflow-wrap: break-word; }

        .col-item { width: 20%; font-weight: 700; color: #333; }
        .col-desc { width: 45%; color: #555; white-space: pre-wrap; }
        .col-qty  { width: 8%; text-align: center; white-space: nowrap; }
        .col-price{ width: 13%; text-align: right; white-space: nowrap; }
        .col-amt  { width: 14%; text-align: right; font-weight: 700; white-space: nowrap; }

        /* å‚™è¨»å€æ¨£å¼ (New) */
        .notes-section { 
            margin-top: 40px; margin-bottom: 30px; 
            font-size: 12px; color: #666; line-height: 1.8; 
            padding: 15px; border-radius: 4px; 
            white-space: pre-wrap; /* ä¿ç•™æ›è¡Œ */
        }

        /* --- é¢¨æ ¼ 1: çŸ¥æ€§ (Intellect) --- */
        .style-intellect { font-family: 'Noto Sans TC', sans-serif; color: #2C3E50; }
        .style-intellect .page-content { padding: 15mm; background-color: #fdfdfd; }
        .style-intellect .header { border-bottom: 4px solid #2C3E50; padding-bottom: 20px; margin-bottom: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
        .style-intellect .title { font-size: 32px; font-weight: 700; letter-spacing: 2px; color: #2C3E50; }
        .style-intellect .meta { text-align: right; font-size: 13px; color: #555; }
        .style-intellect .info-box { background: #ECF0F1; padding: 20px; border-radius: 4px; margin-bottom: 30px; display: flex; gap: 30px; }
        .style-intellect .info-col { flex: 1; }
        .style-intellect .info-label { font-size: 12px; font-weight: 700; color: #7F8C8D; margin-bottom: 5px; }
        .style-intellect .info-val { font-size: 15px; font-weight: 500; color: #2C3E50; }
        .style-intellect th { background: #2C3E50; color: #fff; padding: 10px 8px; font-size: 13px; font-weight: 500; text-align: left; }
        .style-intellect td { border-bottom: 1px solid #BDC3C7; }
        .style-intellect .total-area { display: flex; justify-content: flex-end; margin-top: 20px; }
        .style-intellect .total-row { width: 250px; display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; }
        .style-intellect .grand { width: 250px; display: flex; justify-content: space-between; border-top: 2px solid #2C3E50; padding-top: 10px; margin-top: 10px; font-size: 18px; font-weight: 700; color: #2C3E50; }
        .style-intellect .notes-section { background-color: #F8F9FA; border-left: 4px solid #2C3E50; }

        /* --- é¢¨æ ¼ 2: è‡ªç„¶ (Nature) --- */
        .style-nature { font-family: 'Noto Serif TC', serif; color: #3E4A3D; background-color: #F8F9F5; }
        .style-nature .page-content { padding: 12mm; }
        .style-nature .header { text-align: center; margin-bottom: 40px; }
        .style-nature .title { font-size: 28px; font-weight: 700; letter-spacing: 5px; color: #5D6D56; border-bottom: 1px solid #A3B19C; display: inline-block; padding-bottom: 10px; margin-bottom: 10px; }
        .style-nature .meta { font-size: 12px; color: #7A8576; font-family: 'Noto Sans TC'; }
        .style-nature .info-wrapper { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .style-nature .info-block { width: 45%; }
        .style-nature .info-head { font-size: 13px; font-weight: 700; color: #5D6D56; border-bottom: 1px dotted #A3B19C; padding-bottom: 5px; margin-bottom: 8px; }
        .style-nature .info-body { font-size: 14px; line-height: 1.6; font-family: 'Noto Sans TC'; }
        .style-nature th { color: #5D6D56; font-weight: 700; border-bottom: 2px solid #5D6D56; padding: 10px 8px; font-size: 13px; text-align: left; }
        .style-nature td { border-bottom: 1px solid #E0E5DF; font-family: 'Noto Sans TC'; }
        .style-nature .total-box { margin-left: auto; width: 250px; background: #fff; padding: 15px; border: 1px solid #E0E5DF; border-radius: 4px; }
        .style-nature .t-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; font-family: 'Noto Sans TC'; }
        .style-nature .t-final { border-top: 1px solid #5D6D56; padding-top: 10px; margin-top: 5px; font-size: 16px; font-weight: 700; color: #5D6D56; display: flex; justify-content: space-between; }
        .style-nature .notes-section { background-color: #fff; border: 1px dashed #A3B19C; color: #5D6D56; }

        /* --- é¢¨æ ¼ 3: æ¥µç°¡ (Minimal) --- */
        .style-minimal { font-family: 'Noto Sans TC', sans-serif; color: #000; }
        .style-minimal .page-content { padding: 15mm 10mm; }
        .style-minimal .header { display: flex; justify-content: space-between; margin-bottom: 50px; }
        .style-minimal .title { font-size: 42px; font-weight: 900; line-height: 1; letter-spacing: -1px; }
        .style-minimal .meta-group { text-align: right; }
        .style-minimal .meta-item { font-size: 13px; font-weight: 500; margin-bottom: 4px; }
        .style-minimal .client-area { margin-bottom: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .style-minimal .label { font-size: 11px; font-weight: 700; color: #999; margin-bottom: 5px; }
        .style-minimal .val { font-size: 16px; font-weight: 500; }
        .style-minimal th { font-weight: 800; font-size: 11px; letter-spacing: 0.5px; color: #000; border-top: 2px solid #000; border-bottom: 1px solid #000; padding: 12px 8px; text-align: left; }
        .style-minimal td { border-bottom: 1px solid #eee; font-weight: 400; padding: 15px 8px; }
        .style-minimal .total-block { margin-top: 30px; text-align: right; }
        .style-minimal .final-price { font-size: 32px; font-weight: 700; margin-top: 10px; display: block; letter-spacing: -1px; }
        .style-minimal .notes-section { border-top: 1px solid #000; padding-left: 0; padding-right: 0; color: #333; }

        /* å°ç«  (å…±ç”¨) */
        .footer-sign { display: flex; justify-content: space-between; margin-top: 30px; font-family: 'Noto Serif TC'; }
        .sign-area { width: 40%; border-top: 1px solid #ccc; padding-top: 10px; font-size: 12px; color: #666; position: relative; }
        .stamp {
            position: absolute; top: -30px; right: 20px;
            width: 80px; height: 80px; border: 3px solid #c0392b; color: #c0392b; opacity: 0.8;
            border-radius: 4px; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 18px; transform: rotate(-5deg); writing-mode: vertical-rl; letter-spacing: 3px;
        }

        @media print {
            .sidebar, .mobile-nav { display: none !important; }
            .preview-area { padding: 0; display: block; background: #fff; height: auto; overflow: visible; }
            .zoom-container { transform: none !important; margin: 0 !important; padding: 0 !important; }
            #invoice-paper { box-shadow: none; transform: none !important; margin: 0; }
        }
    </style>
</head>
<body data-view="edit">

    <div class="mobile-nav">
        <div class="nav-grid">
            <button class="nav-item active" onclick="switchView('edit', this)">ğŸ“ ç·¨è¼¯è³‡æ–™</button>
            <button class="nav-item" onclick="switchView('preview', this)">ğŸ‘ï¸ é è¦½å ±åƒ¹</button>
            <button class="nav-item" onclick="exportPDF()">ğŸ“¥ ä¸‹è¼‰ PDF</button>
        </div>
    </div>

    <div class="sidebar">
        <div class="sidebar-content">
            <h2>å ±åƒ¹å–®è¨­å®š</h2>
            
            <div class="form-section">
                <span class="label">é¸æ“‡é¢¨æ ¼</span>
                <div class="style-grid">
                    <div class="style-card btn-intellect active" onclick="setStyle('style-intellect', this)">
                        <span>çŸ¥æ€§</span><small>æ·±è— x ç±³ç°</small>
                    </div>
                    <div class="style-card btn-nature" onclick="setStyle('style-nature', this)">
                        <span>è‡ªç„¶</span><small>æ£®ç¶  x æš–ç™½</small>
                    </div>
                    <div class="style-card btn-minimal" onclick="setStyle('style-minimal', this)">
                        <span>æ¥µç°¡</span><small>é»‘ç™½ x ç°éš</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <span class="label">åŸºæœ¬è³‡æ–™</span>
                <input type="date" id="in-date" class="form-control" onchange="render()">
                <input type="text" id="in-client" class="form-control" placeholder="å®¢æˆ¶åç¨±" value="å¿«æ¨‚ä¼æ¥­" oninput="render()">
                <input type="text" id="in-tax" class="form-control" placeholder="å®¢æˆ¶çµ±ç·¨" value="12345678" oninput="render()">
            </div>

            <div class="form-section">
                <span class="label">å‚™è¨»å…§å®¹ (å¯ç·¨è¼¯)</span>
                <textarea id="in-notes" class="form-control" style="min-height:100px" oninput="render()">
1. æœ¬å ±åƒ¹å–®æœ‰æ•ˆæœŸé™ç‚º 30 å¤©ï¼Œé€¾æœŸè«‹é‡æ–°è©¢åƒ¹ã€‚
2. åŒ¯æ¬¾æ‰‹çºŒè²»ç”±ä»˜æ¬¾æ–¹æ‰¿æ“”ã€‚
3. è«‹æ–¼æœå‹™çµæŸå¾Œ 15 æ—¥å…§å®Œæˆä»˜æ¬¾ã€‚
4. ä»¥ä¸Šé‡‘é¡ç‚ºæ–°å°å¹£ (TWD) è¨ˆåƒ¹ã€‚</textarea>
            </div>

            <div class="form-section">
                <span class="label">å ±åƒ¹é …ç›®</span>
                <div id="item-list"></div>
                <button class="btn-add" onclick="addItem()">+ æ–°å¢é …ç›®</button>
            </div>
        </div>

        <div class="desktop-download">
            <button class="btn-main" onclick="exportPDF()">ä¸‹è¼‰ PDF å ±åƒ¹å–®</button>
        </div>
    </div>

    <div class="preview-area">
        <div class="zoom-container" id="zoom-container">
            <div id="invoice-paper" class="style-intellect">
                <div class="page-content">
                    <div id="dynamic-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStyle = 'style-intellect';
        let items = [
            { name: "è¬›å¸«è²»", desc: "å°ˆæ¥­èª²ç¨‹æˆèª²åŠç ”ä¿®è³‡æ–™è£½ä½œ\nåŒ…å«ï¼šç°¡å ±è£½ä½œã€è¬›ç¾©ç·¨æ’ã€ç¾å ´QA", qty: 1, price: 6000 }
        ];

        window.onload = () => {
            document.getElementById('in-date').value = new Date().toISOString().split('T')[0];
            renderEditor();
            render();
            autoZoom();
            window.addEventListener('resize', autoZoom);
        };

        function autoZoom() {
            const previewArea = document.querySelector('.preview-area');
            const zoomContainer = document.getElementById('zoom-container');
            const paperWidth = 794; 
            const availableWidth = previewArea.clientWidth - 60; 
            let scale = availableWidth / paperWidth;
            if (scale > 1.2) scale = 1.2;
            
            zoomContainer.style.transform = `scale(${scale})`;
            zoomContainer.style.height = `${1123 * scale}px`;
            zoomContainer.style.width = `${paperWidth}px`;
        }

        function renderEditor() {
            const list = document.getElementById('item-list');
            list.innerHTML = '';
            items.forEach((item, i) => {
                const el = document.createElement('div');
                el.className = 'item-row';
                el.innerHTML = `
                    <button class="btn-del" onclick="delItem(${i})">ç§»é™¤</button>
                    <input type="text" class="form-control" placeholder="é …ç›®åç¨±" value="${item.name}" oninput="updateItem(${i}, 'name', this.value)">
                    <textarea class="form-control" style="min-height:60px" placeholder="å…§å®¹èªªæ˜" oninput="updateItem(${i}, 'desc', this.value)">${item.desc}</textarea>
                    <div style="display:flex; gap:10px;">
                        <input type="number" class="form-control" placeholder="æ•¸é‡" value="${item.qty}" oninput="updateItem(${i}, 'qty', this.value)">
                        <input type="number" class="form-control" placeholder="å–®åƒ¹" value="${item.price}" oninput="updateItem(${i}, 'price', this.value)">
                    </div>
                `;
                list.appendChild(el);
            });
        }

        function addItem() { items.push({name:"", desc:"", qty:1, price:0}); renderEditor(); render(); }
        function delItem(i) { items.splice(i, 1); renderEditor(); render(); }
        function updateItem(i, k, v) { items[i][k] = (k==='qty'||k==='price') ? (parseFloat(v)||0) : v; render(); }

        function render() {
            const container = document.getElementById('dynamic-content');
            const dStr = document.getElementById('in-date').value;
            const d = new Date(dStr || Date.now());
            const dateStr = `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
            const invNo = `QU-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}-001`;
            const client = document.getElementById('in-client').value || "å®¢æˆ¶åç¨±";
            const taxId = document.getElementById('in-tax').value || "12345678";
            const notes = document.getElementById('in-notes').value;

            let subtotal = 0;
            const rowsHtml = items.map(item => {
                const amt = Math.round(item.qty * item.price);
                subtotal += amt;
                return `<tr>
                    <td class="col-item">${item.name}</td>
                    <td class="col-desc">${item.desc}</td>
                    <td class="col-qty">${item.qty}</td>
                    <td class="col-price">${item.price.toLocaleString()}</td>
                    <td class="col-amt">${amt.toLocaleString()}</td>
                </tr>`;
            }).join('');
            
            const spacer = items.length < 5 ? `<tr><td colspan="5" style="height:${(5-items.length)*40}px; border-bottom:none"></td></tr>` : '';
            const tax = Math.round(subtotal * 0.05);
            const total = subtotal + tax;

            if (currentStyle === 'style-intellect') {
                container.innerHTML = `
                    <div class="header">
                        <div class="title">å ±åƒ¹å–®</div>
                        <div class="meta">å–®è™Ÿï¼š${invNo}<br>æ—¥æœŸï¼š${dateStr}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-col">
                            <div class="info-label">å®¢æˆ¶è³‡è¨Š</div>
                            <div class="info-val">${client}</div>
                            <div style="font-size:13px; color:#555">çµ±ç·¨ï¼š${taxId}</div>
                        </div>
                        <div class="info-col" style="text-align:right">
                            <div class="info-label">é–‹ç«‹å–®ä½</div>
                            <div class="info-val">ç–æ£®å·¥ä½œå®¤</div>
                            <div style="font-size:13px; color:#555">contact@jousen-studio.com</div>
                        </div>
                    </div>
                    <table class="inv-table">
                        <thead><tr><th class="col-item">é …ç›®</th><th class="col-desc">å…§å®¹èªªæ˜</th><th class="col-qty">æ•¸é‡</th><th class="col-price">å–®åƒ¹</th><th class="col-amt">é‡‘é¡</th></tr></thead>
                        <tbody>${rowsHtml}${spacer}</tbody>
                    </table>
                    <div class="total-area">
                        <div>
                            <div class="total-row"><span>å°è¨ˆ</span><span>${subtotal.toLocaleString()}</span></div>
                            <div class="total-row"><span>ç¨…é¡ (5%)</span><span>${tax.toLocaleString()}</span></div>
                            <div class="grand"><span>ç¸½è¨ˆ</span><span>NT$ ${total.toLocaleString()}</span></div>
                        </div>
                    </div>
                    <div class="notes-section"><strong>å‚™è¨»äº‹é …ï¼š</strong><br>${notes}</div>
                    <div class="footer-sign">
                        <div class="sign-area">å®¢æˆ¶ç°½ç½²</div>
                        <div class="sign-area" style="text-align:right">ç–æ£®å·¥ä½œå®¤<div class="stamp">ç–æ£®<br>ä¹‹å°</div></div>
                    </div>
                `;
            } 
            else if (currentStyle === 'style-nature') {
                container.innerHTML = `
                    <div class="header">
                        <div class="title">å ±åƒ¹å–®</div>
                        <div class="meta">No. ${invNo} | Date. ${dateStr}</div>
                    </div>
                    <div class="info-wrapper">
                        <div class="info-block">
                            <div class="info-head">å®¢æˆ¶è³‡æ–™</div>
                            <div class="info-body"><strong>${client}</strong><br>çµ±ç·¨ï¼š${taxId}</div>
                        </div>
                        <div class="info-block" style="text-align:right">
                            <div class="info-head">æœå‹™å–®ä½</div>
                            <div class="info-body"><strong>ç–æ£®å·¥ä½œå®¤</strong><br>å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ</div>
                        </div>
                    </div>
                    <table class="inv-table">
                        <thead><tr><th class="col-item">é …ç›®åç¨±</th><th class="col-desc">å…§å®¹èªªæ˜</th><th class="col-qty">æ•¸é‡</th><th class="col-price">å–®åƒ¹</th><th class="col-amt">é‡‘é¡</th></tr></thead>
                        <tbody>${rowsHtml}${spacer}</tbody>
                    </table>
                    <div class="total-box">
                        <div class="t-row"><span>å°è¨ˆ</span><span>${subtotal.toLocaleString()}</span></div>
                        <div class="t-row"><span>ç¨…é¡ (5%)</span><span>${tax.toLocaleString()}</span></div>
                        <div class="t-final"><span>ç¸½è¨ˆ</span><span>NT$ ${total.toLocaleString()}</span></div>
                    </div>
                    <div class="notes-section"><strong>å‚™è¨»äº‹é …ï¼š</strong><br>${notes}</div>
                    <div class="footer-sign">
                        <div class="sign-area">å®¢æˆ¶ç¢ºèª</div>
                        <div class="sign-area" style="text-align:right">å–®ä½ç”¨å°<div class="stamp" style="border-color:#5D6D56; color:#5D6D56; border-radius:50%">ç–æ£®</div></div>
                    </div>
                `;
            }
            else if (currentStyle === 'style-minimal') {
                container.innerHTML = `
                    <div class="header">
                        <div class="title">QUOTE</div>
                        <div class="meta-group">
                            <div class="meta-item"># ${invNo}</div>
                            <div class="meta-item">${dateStr}</div>
                        </div>
                    </div>
                    <div class="client-area">
                        <div>
                            <div class="label">å®¢æˆ¶åç¨± (CLIENT)</div>
                            <div class="val">${client}</div>
                            <div style="font-size:13px; margin-top:5px">çµ±ç·¨ï¼š${taxId}</div>
                        </div>
                        <div>
                            <div class="label">é–‹ç«‹äºº (PROVIDER)</div>
                            <div class="val">ç–æ£®å·¥ä½œå®¤</div>
                        </div>
                    </div>
                    <table class="inv-table">
                        <thead><tr><th class="col-item">ITEM</th><th class="col-desc">DESC</th><th class="col-qty">QTY</th><th class="col-price">PRICE</th><th class="col-amt">AMOUNT</th></tr></thead>
                        <tbody>${rowsHtml}${spacer}</tbody>
                    </table>
                    <div class="total-block">
                        <div style="font-size:14px; font-weight:500">SUBTOTAL: ${subtotal.toLocaleString()}</div>
                        <div style="font-size:14px; font-weight:500">TAX (5%): ${tax.toLocaleString()}</div>
                        <span class="final-price">NT$ ${total.toLocaleString()}</span>
                    </div>
                    <div class="notes-section">${notes}</div>
                    <div class="footer-sign">
                        <div class="sign-area" style="border-color:#000; color:#000">CLIENT SIGNATURE</div>
                        <div class="sign-area" style="border-color:#000; color:#000; text-align:right">AUTHORIZED<div class="stamp" style="border:3px solid #000; color:#000; border-radius:0;">ç–æ£®</div></div>
                    </div>
                `;
            }
        }

        function setStyle(styleName, btn) {
            currentStyle = styleName;
            document.getElementById('invoice-paper').className = styleName;
            document.querySelectorAll('.style-card').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        function switchView(view, btn) {
            document.body.setAttribute('data-view', view);
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(view === 'preview') setTimeout(autoZoom, 100);
        }

        function exportPDF() {
            const element = document.getElementById('invoice-paper');
            const no = document.getElementById('in-date').value.replace(/-/g,'') || 'quote';
            const zoomContainer = document.getElementById('zoom-container');
            const originalTransform = zoomContainer.style.transform;
            zoomContainer.style.transform = 'none';

            const opt = {
                margin: 0,
                filename: `å ±åƒ¹å–®_${no}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                zoomContainer.style.transform = originalTransform;
            });
        }
    </script>
</body>
</html>

